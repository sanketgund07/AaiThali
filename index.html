
<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>рдЖрдИрдЪреА рд╕реНрд╡рд╛рд╕реНрдереНрдп рдерд╛рд│реА - рдорд╣рд╛рд░рд╛рд╖реНрдЯреНрд░реАрдпрди рдореАрд▓ рдкреНрд▓реЕрдирд░</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@19.2.4",
        "react-dom/client": "https://esm.sh/react-dom@19.2.4/client",
        "@google/genai": "https://esm.sh/@google/genai@1.40.0",
        "recharts": "https://esm.sh/recharts@3.7.0",
        "htm": "https://esm.sh/htm@3.1.1"
      }
    }
    </script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fcfaf7;
            font-size: 18px;
            color: #1a1a1a;
            -webkit-tap-highlight-color: transparent;
        }
        .font-serif { font-family: 'Playfair Display', serif; }
        .recharts-legend-item-text { font-size: 14px !important; font-weight: 600 !important; }
        html { scroll-behavior: smooth; }
        .animate-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useCallback } from 'react';
        import { createRoot } from 'react-dom/client';
        import { GoogleGenAI, Type } from "@google/genai";
        import * as Recharts from 'recharts';
        import htm from 'htm';

        const { PieChart, Pie, Cell, ResponsiveContainer, Tooltip, Legend } = Recharts;
        const html = htm.bind(React.createElement);

        // --- CONSTANTS & CONFIG ---
        const COLORS = { veggie: '#10b981', fruit: '#ec4899', protein: '#f97316', carb: '#eab308', other: '#94a3b8' };

        const INVENTORY = {
          rashan: { title: "рдзрд╛рдиреНрдп", items: ["рдЬреНрд╡рд╛рд░реА", "рдмрд╛рдЬрд░реА", "рдирд╛рдЪрдгреА", "рдЧрд╣реВ", "рд╣рд╛рддрд╕рдбреАрдЪрд╛ рддрд╛рдВрджреВрд│", "рд╡рд░рдИ"] },
          pulses: { title: "рдХрдбрдзрд╛рдиреНрдпреЗ/рдбрд╛рд│реА", items: ["рдордЯрдХреА", "рдореВрдЧ", "рддреВрд░ рдбрд╛рд│", "рд╣рд░рднрд░рд╛", "рдХреБрд│реАрде", "рд╡рд╛рдЯрд╛рдгрд╛"] },
          veggies: { title: "рднрд╛рдЬреНрдпрд╛", items: ["рдореЗрдереА", "рдкрд╛рд▓рдХ", "рджреЛрдбрдХрд╛", "рднреЗрдВрдбреА", "рджреБрдзреА", "рдХреЛрдмреА", "рдХрд╛рд░рд▓реЗ", "рдЧрд╡рд╛рд░", "рд╡рд╛рдВрдЧреА"] },
          other: { title: "рдЗрддрд░", items: ["рджрд╣реА", "рддрд╛рдХ", "рд▓рд╕реВрдг", "рдЖрд▓реЗ", "рдореЗрдереА рджрд╛рдгреЗ", "рдЖрдорд╕реВрд▓"] }
        };

        const MEAL_ITEM_SCHEMA = {
          type: Type.OBJECT,
          properties: {
            name: { type: Type.STRING },
            category: { type: Type.STRING },
            description: { type: Type.STRING },
            recipe: { type: Type.STRING }
          },
          required: ["name", "category", "description", "recipe"]
        };

        const MEAL_SCHEMA = {
          type: Type.OBJECT,
          properties: {
            time: { type: Type.STRING },
            items: { type: Type.ARRAY, items: MEAL_ITEM_SCHEMA },
            healthTip: { type: Type.STRING },
            nutritionFocus: { type: Type.STRING }
          },
          required: ["time", "items", "healthTip", "nutritionFocus"]
        };

        const MEAL_PLAN_SCHEMA = {
          type: Type.OBJECT,
          properties: {
            meals: {
              type: Type.OBJECT,
              properties: {
                breakfast: MEAL_SCHEMA,
                lunch: MEAL_SCHEMA,
                eveningSnack: MEAL_SCHEMA,
                dinner: MEAL_SCHEMA
              },
              required: ["breakfast", "lunch", "eveningSnack", "dinner"]
            }
          },
          required: ["meals"]
        };

        // --- COMPONENTS ---

        const ThaliChart = () => {
          const data = [
            { name: 'рднрд╛рдЬреНрдпрд╛ (релреж%)', value: 50, color: COLORS.veggie },
            { name: 'рдкреНрд░рдерд┐рдиреЗ (реирел%)', value: 25, color: COLORS.protein },
            { name: 'рдХрд╛рд░реНрдмреНрд╕ (реирел%)', value: 25, color: COLORS.carb },
          ];
          return html`
            <div className="h-64 w-full">
              <${ResponsiveContainer} width="100%" height="100%">
                <${PieChart}>
                  <${Pie} data=${data} cx="50%" cy="50%" innerRadius=${60} outerRadius=${80} paddingAngle=${5} dataKey="value">
                    ${data.map((entry, index) => html`<${Cell} key=${`cell-${index}`} fill=${entry.color} />`)}
                  <//>
                  <${Tooltip} />
                  <${Legend} />
                <//>
              <//>
            </div>
          `;
        };

        const ThaliCard = ({ meal, type }) => {
          if (!meal) return null;
          const icons = { breakfast: 'ЁЯМЕ', lunch: 'тШАя╕П', eveningSnack: 'тШХ', dinner: 'ЁЯМЩ' };
          const labels = { breakfast: 'рдиреНрдпрд╛рд╣рд╛рд░реА', lunch: 'рджреБрдкрд╛рд░рдЪреЗ рдЬреЗрд╡рдг', eveningSnack: 'рдирд╛рд╢реНрддрд╛', dinner: 'рд░рд╛рддреНрд░реАрдЪреЗ рдЬреЗрд╡рдг' };

          return html`
            <div className="mb-8 animate-in">
              <div className="flex items-center gap-4 mb-4">
                <span className="text-4xl">${icons[type]}</span>
                <div>
                  <h3 className="text-2xl font-serif font-bold text-stone-900">${labels[type]}</h3>
                  <p className="text-stone-400 font-bold text-sm uppercase tracking-tighter">${meal.time}</p>
                </div>
              </div>
              <div className="bg-white rounded-[32px] p-6 shadow-sm border border-stone-100">
                <div className="mb-4 inline-block bg-emerald-50 text-emerald-700 px-3 py-1 rounded-full text-xs font-bold border border-emerald-100">
                  ${meal.nutritionFocus}
                </div>
                <div className="space-y-4">
                  ${meal.items?.map((item, idx) => html`
                    <div key=${idx} className=${`p-4 rounded-2xl border-l-4 ${item.category === 'veggie' ? 'border-emerald-500 bg-emerald-50' : item.category === 'protein' ? 'border-orange-500 bg-orange-50' : 'border-yellow-500 bg-yellow-50'}`}>
                      <h4 className="font-bold text-stone-800 text-lg mb-1">${item.name}</h4>
                      <p className="text-stone-600 text-sm mb-2">${item.description}</p>
                      ${item.recipe && html`<p className="text-xs text-stone-400 italic mt-2 pt-2 border-t border-stone-200"><span className="font-bold">рдХреГрддреА:</span> ${item.recipe}</p>`}
                    </div>
                  `)}
                </div>
                <div className="mt-5 p-4 bg-blue-50 rounded-2xl text-blue-800 text-sm">
                  ЁЯТб <b>рдЯрд┐рдк:</b> ${meal.healthTip}
                </div>
              </div>
            </div>
          `;
        };

        const App = () => {
          const [activeTab, setActiveTab] = useState('plan');
          const [loading, setLoading] = useState(true);
          const [mealPlan, setMealPlan] = useState(null);
          const [error, setError] = useState(null);
          const [selected, setSelected] = useState(new Set());

          const fetchPlan = useCallback(async () => {
            setLoading(true);
            setError(null);
            try {
              const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
              const itemsStr = Array.from(selected).join(", ");
              const prompt = `You are a professional Maharashtrian nutritionist. Create a 50-25-25 thali rule meal plan for a 50-year-old mother with cholesterol and diabetes. Use standard Maharashtrian dishes. 
              Available ingredients: ${itemsStr || "all standard Maharashtrian grains and vegetables"}. 
              Instructions:
              1. 50% must be fiber/veggies/fruits.
              2. 25% protein.
              3. 25% carbs (Low GI like Jowar/Bajra/Nachni).
              4. All text in output must be in Marathi.
              5. Low oil, no sugar.`;

              const response = await ai.models.generateContent({
                model: "gemini-3-pro-preview",
                contents: [{ role: 'user', parts: [{ text: prompt }] }],
                config: { 
                    responseMimeType: "application/json", 
                    responseSchema: MEAL_PLAN_SCHEMA
                }
              });

              if (response.text) {
                const parsed = JSON.parse(response.text);
                setMealPlan(parsed);
              }
              window.scrollTo({ top: 0, behavior: 'smooth' });
            } catch (err) {
              console.error("AI Error:", err);
              setError(`рдирд┐рдпреЛрдЬрди рдХрд░рддрд╛рдирд╛ рдЕрдбрдЪрдг рдЖрд▓реА: ${err.message || 'Unknown error'}. рдХреГрдкрдпрд╛ рдкреБрдиреНрд╣рд╛ рдкреНрд░рдпрддреНрди рдХрд░рд╛.`);
            } finally {
              setLoading(false);
            }
          }, [selected]);

          useEffect(() => { fetchPlan(); }, []);

          const toggle = (item) => {
            const next = new Set(selected);
            if (next.has(item)) next.delete(item); else next.add(item);
            setSelected(next);
          };

          if (loading) return html`
            <div className="min-h-screen flex flex-col items-center justify-center p-10 bg-stone-50">
              <div className="w-12 h-12 border-4 border-orange-200 border-t-orange-600 rounded-full animate-spin mb-4"></div>
              <h2 className="text-xl font-serif font-bold text-stone-800 text-center">рдЖрдИрд╕рд╛рдареА рдЦрд╛рд╕ рд╕реНрд╡рд╛рд╕реНрдереНрдп рдерд╛рд│реА рддрдпрд╛рд░ рд╣реЛрдд рдЖрд╣реЗ...</h2>
            </div>
          `;

          return html`
            <div className="max-w-lg mx-auto px-4 py-8 pb-24">
              <header className="text-center mb-8">
                <h1 className="text-4xl font-serif font-bold text-stone-900 mb-2">рдЖрдИрдЪреА рд╕реНрд╡рд╛рд╕реНрдереНрдп рдерд╛рд│реА</h1>
                <p className="text-emerald-700 text-xs font-bold uppercase tracking-widest">рдХреЛрд▓реЗрд╕реНрдЯреНрд░реЙрд▓ рдЖрдгрд┐ рдордзреБрдореЗрд╣ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди</p>
              </header>

              <nav className="flex bg-white p-1.5 rounded-2xl shadow-sm border border-stone-200 mb-8 sticky top-4 z-50">
                ${['plan', 'tips', 'stats'].map(t => html`
                  <button key=${t} onClick=${() => setActiveTab(t)} className=${`flex-1 py-3 rounded-xl font-bold text-sm transition-all ${activeTab === t ? 'bg-orange-600 text-white shadow-md' : 'text-stone-400 hover:text-stone-600'}`}>
                    ${t === 'plan' ? 'рдЖрдЬрдЪрд╛ рдЖрд╣рд╛рд░' : t === 'tips' ? 'рдЖрд░реЛрдЧреНрдп рдЯрд┐рдкреНрд╕' : 'рдирд┐рдпрдо'}
                  </button>
                `)}
              </nav>

              ${error && html`
                <div className="bg-red-50 text-red-700 p-4 rounded-2xl mb-8 text-center text-sm border border-red-100">
                  ${error} <button onClick=${fetchPlan} className="underline font-bold ml-2">рдкреБрдиреНрд╣рд╛ рдкреНрд░рдпрддреНрди рдХрд░рд╛</button>
                </div>
              `}

              ${activeTab === 'plan' && html`
                <div>
                  <section className="bg-white rounded-[32px] p-6 shadow-sm border border-stone-100 mb-8">
                    <h3 className="text-xl font-bold mb-4 font-serif">ЁЯПа рдХрд╛рдп рдЙрдкрд▓рдмреНрдз рдЖрд╣реЗ?</h3>
                    <div className="space-y-6">
                      ${Object.entries(INVENTORY).map(([key, cat]) => html`
                        <div key=${key}>
                          <p className="text-[10px] font-black text-stone-300 uppercase mb-2">${cat.title}</p>
                          <div className="flex flex-wrap gap-2">
                            ${cat.items.map(item => html`
                              <button key=${item} onClick=${() => toggle(item)} className=${`px-3 py-1.5 rounded-xl border text-sm font-semibold transition-all ${selected.has(item) ? 'bg-orange-600 text-white border-orange-600 shadow-sm' : 'bg-stone-50 text-stone-600 border-stone-200 hover:border-orange-200'}`}>
                                ${item}
                              </button>
                            `)}
                          </div>
                        </div>
                      `)}
                      <button onClick=${fetchPlan} className="w-full bg-stone-900 text-white py-4 rounded-2xl font-bold text-lg shadow-xl active:scale-95 hover:bg-stone-800 transition-all">тЬи рдерд╛рд│реА рдЕрдкрдбреЗрдЯ рдХрд░рд╛</button>
                    </div>
                  </section>

                  ${mealPlan?.meals && html`
                    <div className="space-y-4">
                      <${ThaliCard} meal=${mealPlan.meals.breakfast} type="breakfast" />
                      <${ThaliCard} meal=${mealPlan.meals.lunch} type="lunch" />
                      <${ThaliCard} meal=${mealPlan.meals.eveningSnack} type="eveningSnack" />
                      <${ThaliCard} meal=${mealPlan.meals.dinner} type="dinner" />
                    </div>
                  `}
                </div>
              `}

              ${activeTab === 'tips' && html`
                <div className="space-y-6">
                  <div className="bg-white p-6 rounded-[32px] border-t-8 border-emerald-500 shadow-sm">
                    <h4 className="text-xl font-bold text-emerald-800 mb-4 font-serif">тЭдя╕П рдХреЛрд▓реЗрд╕реНрдЯреНрд░реЙрд▓рд╕рд╛рдареА</h4>
                    <ul className="space-y-3 text-stone-600 text-sm">
                      <li className="flex gap-2"><span>тЬЕ</span> рд░реЛрдЬрдЪреНрдпрд╛ рдЖрд╣рд╛рд░рд╛рдд рд▓рд╕рдгрд╛рдЪреНрдпрд╛ реи рдкрд╛рдХрд│реНрдпрд╛ рдХреЛрдордЯ рдкрд╛рдгреНрдпрд╛рд╕реЛрдмрдд рдШреНрдпрд╛.</li>
                      <li className="flex gap-2"><span>тЬЕ</span> рдУрд▓рд╛ рдирд╛рд░рд│ рдЖрдгрд┐ рд╢реЗрдВрдЧрджрд╛рдгреНрдпрд╛рдЪрд╛ рд╡рд╛рдкрд░ релреж% рдХрдореА рдХрд░рд╛.</li>
                      <li className="flex gap-2"><span>тЬЕ</span> рддреЗрд▓рд╛рдРрд╡рдЬреА рднрд╛рдЬрд▓реЗрд▓реЗ рдХрд┐рдВрд╡рд╛ рдЙрдХрдбрд▓реЗрд▓реЗ рдкрджрд╛рд░реНрде рдЬрд╛рд╕реНрдд рдЦрд╛.</li>
                    </ul>
                  </div>
                  <div className="bg-white p-6 rounded-[32px] border-t-8 border-orange-500 shadow-sm">
                    <h4 className="text-xl font-bold text-orange-800 mb-4 font-serif">ЁЯй╕ рдордзреБрдореЗрд╣рд╛рд╕рд╛рдареА</h4>
                    <ul className="space-y-3 text-stone-600 text-sm">
                      <li className="flex gap-2"><span>тЬЕ</span> рдЪрд╣рд╛ рдХрд┐рдВрд╡рд╛ рдХреЙрдлреАрдордзреНрдпреЗ рд╕рд╛рдЦрд░ рдкреВрд░реНрдгрдкрдгреЗ рдмрдВрдж рдХрд░рд╛.</li>
                      <li className="flex gap-2"><span>тЬЕ</span> рдЧрд╡реНрдпрд╛рдЪреНрдпрд╛ рдкреЛрд│реАрдкреЗрдХреНрд╖рд╛ рдирд╛рдЪрдгреА рдХрд┐рдВрд╡рд╛ рдЬреНрд╡рд╛рд░реАрдЪреА рднрд╛рдХрд░реА рдЙрддреНрддрдо.</li>
                      <li className="flex gap-2"><span>тЬЕ</span> рдЬреЗрд╡рдгрд╛рдирдВрддрд░ рд▓рдЧреЗрдЪ рдмрд╕реВ рдирдХрд╛, рдХрд┐рдорд╛рди резреж рдорд┐рдирд┐рдЯреЗ рдЪрд╛рд▓рд╛.</li>
                    </ul>
                  </div>
                </div>
              `}

              ${activeTab === 'stats' && html`
                <div className="bg-white p-8 rounded-[32px] shadow-sm text-center">
                  <h3 className="text-2xl font-serif font-bold mb-6">рдбреЙрдХреНрдЯрд░рд╛рдВрдЪрд╛ 'релреж-реирел-реирел' рдирд┐рдпрдо</h3>
                  <${ThaliChart} />
                  <div className="mt-8 space-y-4 text-left">
                    <div className="p-4 bg-emerald-50 rounded-2xl border border-emerald-100">
                      <p className="font-bold text-emerald-800">релреж% рднрд╛рдЬреНрдпрд╛/рдлрд│реЗ:</p>
                      <p className="text-xs text-stone-500">рдлрд╛рдпрдмрд░рдореБрд│реЗ рдХреЛрд▓реЗрд╕реНрдЯреНрд░реЙрд▓ рдирд┐рдпрдВрддреНрд░рдгрд╛рдд рд░рд╛рд╣рддреЗ.</p>
                    </div>
                    <div className="p-4 bg-orange-50 rounded-2xl border border-orange-100">
                      <p className="font-bold text-orange-800">реирел% рдкреНрд░рдерд┐рдиреЗ:</p>
                      <p className="text-xs text-stone-500">рдбрд╛рд│реА рдЖрдгрд┐ рдХрдбрдзрд╛рдиреНрдпреЗ рд╢рд░реАрд░рд╛рд▓рд╛ рддрд╛рдХрдж рджреЗрддрд╛рдд.</p>
                    </div>
                    <div className="p-4 bg-yellow-50 rounded-2xl border border-yellow-100">
                      <p className="font-bold text-yellow-800">реирел% рдХрд╛рд░реНрдмреЛрд╣рд╛рдпрдбреНрд░реЗрдЯреНрд╕:</p>
                      <p className="text-xs text-stone-500">рднрд╛рдХрд░реА рдХрд┐рдВрд╡рд╛ рд╣рд╛рддрд╕рдбреАрдЪрд╛ рддрд╛рдВрджреВрд│ рд╕рд╛рдЦрд░ рд╡рд╛рдвреВ рджреЗрдд рдирд╛рд╣реА.</p>
                    </div>
                  </div>
                </div>
              `}

              <footer className="mt-12 text-center text-stone-300 text-[10px] font-bold uppercase tracking-widest">
                рдЖрдИрдЪреНрдпрд╛ рдЙрддреНрддрдо рдЖрд░реЛрдЧреНрдпрд╛рд╕рд╛рдареА тЭдя╕П реирежреирек
              </footer>
            </div>
          `;
        };

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>

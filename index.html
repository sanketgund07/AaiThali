
<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>рдЖрдИрдЪреА рд╕реНрд╡рд╛рд╕реНрдереНрдп рдерд╛рд│реА - рдорд╣рд╛рд░рд╛рд╖реНрдЯреНрд░реАрдпрди рдореАрд▓ рдкреНрд▓реЕрдирд░</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    
    <script>
        // Global shim to prevent "process is not defined" errors in non-Node environments
        window.process = window.process || { env: { API_KEY: "" } };
    </script>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@19.2.4",
        "react-dom/client": "https://esm.sh/react-dom@19.2.4/client",
        "@google/genai": "https://esm.sh/@google/genai@1.40.0",
        "recharts": "https://esm.sh/recharts@3.7.0",
        "htm": "https://esm.sh/htm@3.1.1"
      }
    }
    </script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fcfaf7;
            font-size: 18px;
            color: #1a1a1a;
            -webkit-tap-highlight-color: transparent;
        }
        .font-serif { font-family: 'Playfair Display', serif; }
        .recharts-legend-item-text { font-size: 14px !important; font-weight: 600 !important; }
        html { scroll-behavior: smooth; }
        .animate-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .custom-shadow { box-shadow: 0 10px 40px -10px rgba(0,0,0,0.05); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useCallback } from 'react';
        import { createRoot } from 'react-dom/client';
        import { GoogleGenAI, Type } from "@google/genai";
        import * as Recharts from 'recharts';
        import htm from 'htm';

        const { PieChart, Pie, Cell, ResponsiveContainer, Tooltip, Legend } = Recharts;
        const html = htm.bind(React.createElement);

        // --- CONSTANTS ---
        const COLORS = { veggie: '#10b981', protein: '#f97316', carb: '#eab308' };
        
        const INVENTORY = {
          rashan: { title: "рдзрд╛рдиреНрдп", items: ["рдЬреНрд╡рд╛рд░реА", "рдмрд╛рдЬрд░реА", "рдирд╛рдЪрдгреА", "рдЧрд╣реВ", "рд╣рд╛рддрд╕рдбреАрдЪрд╛ рддрд╛рдВрджреВрд│", "рд╡рд░рдИ"] },
          pulses: { title: "рдХрдбрдзрд╛рдиреНрдпреЗ/рдбрд╛рд│реА", items: ["рдордЯрдХреА", "рдореВрдЧ", "рддреВрд░ рдбрд╛рд│", "рд╣рд░рднрд░рд╛", "рдХреБрд│реАрде", "рд╡рд╛рдЯрд╛рдгрд╛"] },
          veggies: { title: "рднрд╛рдЬреНрдпрд╛", items: ["рдореЗрдереА", "рдкрд╛рд▓рдХ", "рджреЛрдбрдХрд╛", "рднреЗрдВрдбреА", "рджреБрдзреА", "рдХреЛрдмреА", "рдХрд╛рд░рд▓реЗ", "рдЧрд╡рд╛рд░", "рд╡рд╛рдВрдЧреА"] },
          other: { title: "рдЗрддрд░", items: ["рджрд╣реА", "рддрд╛рдХ", "рд▓рд╕реВрдг", "рдЖрд▓реЗ", "рдореЗрдереА рджрд╛рдгреЗ", "рдЖрдорд╕реВрд▓"] }
        };

        const MEAL_PLAN_SCHEMA = {
          type: Type.OBJECT,
          properties: {
            meals: {
              type: Type.OBJECT,
              properties: {
                breakfast: { type: Type.OBJECT, properties: { time: {type: Type.STRING}, items: {type: Type.ARRAY, items: {type: Type.OBJECT, properties: {name: {type: Type.STRING}, category: {type: Type.STRING}, description: {type: Type.STRING}}}}, healthTip: {type: Type.STRING}, nutritionFocus: {type: Type.STRING} } },
                lunch: { type: Type.OBJECT, properties: { time: {type: Type.STRING}, items: {type: Type.ARRAY, items: {type: Type.OBJECT, properties: {name: {type: Type.STRING}, category: {type: Type.STRING}, description: {type: Type.STRING}}}}, healthTip: {type: Type.STRING}, nutritionFocus: {type: Type.STRING} } },
                eveningSnack: { type: Type.OBJECT, properties: { time: {type: Type.STRING}, items: {type: Type.ARRAY, items: {type: Type.OBJECT, properties: {name: {type: Type.STRING}, category: {type: Type.STRING}, description: {type: Type.STRING}}}}, healthTip: {type: Type.STRING}, nutritionFocus: {type: Type.STRING} } },
                dinner: { type: Type.OBJECT, properties: { time: {type: Type.STRING}, items: {type: Type.ARRAY, items: {type: Type.OBJECT, properties: {name: {type: Type.STRING}, category: {type: Type.STRING}, description: {type: Type.STRING}}}}, healthTip: {type: Type.STRING}, nutritionFocus: {type: Type.STRING} } }
              },
              required: ["breakfast", "lunch", "eveningSnack", "dinner"]
            }
          },
          required: ["meals"]
        };

        // --- COMPONENTS ---

        const ThaliChart = () => {
          const data = [
            { name: 'рднрд╛рдЬреНрдпрд╛ (релреж%)', value: 50, color: COLORS.veggie },
            { name: 'рдкреНрд░рдерд┐рдиреЗ (реирел%)', value: 25, color: COLORS.protein },
            { name: 'рдХрд╛рд░реНрдмреНрд╕ (реирел%)', value: 25, color: COLORS.carb },
          ];
          return html`
            <div className="h-64 w-full">
              <${ResponsiveContainer} width="100%" height="100%">
                <${PieChart}>
                  <${Pie} data=${data} cx="50%" cy="50%" innerRadius=${60} outerRadius=${80} paddingAngle=${5} dataKey="value">
                    ${data.map((entry, index) => html`<${Cell} key=${`cell-${index}`} fill=${entry.color} />`)}
                  <//>
                  <${Tooltip} />
                  <${Legend} />
                <//>
              <//>
            </div>
          `;
        };

        const ThaliCard = ({ meal, type }) => {
          if (!meal) return null;
          const icons = { breakfast: 'ЁЯМЕ', lunch: 'тШАя╕П', eveningSnack: 'тШХ', dinner: 'ЁЯМЩ' };
          const labels = { breakfast: 'рдиреНрдпрд╛рд╣рд╛рд░реА', lunch: 'рджреБрдкрд╛рд░рдЪреЗ рдЬреЗрд╡рдг', eveningSnack: 'рдирд╛рд╢реНрддрд╛', dinner: 'рд░рд╛рддреНрд░реАрдЪреЗ рдЬреЗрд╡рдг' };

          return html`
            <div className="mb-8 animate-in">
              <div className="flex items-center gap-4 mb-4 px-2">
                <span className="text-4xl filter drop-shadow-sm">${icons[type]}</span>
                <div>
                  <h3 className="text-2xl font-serif font-bold text-stone-900 leading-tight">${labels[type]}</h3>
                  <p className="text-stone-400 font-bold text-[10px] uppercase tracking-widest">${meal.time}</p>
                </div>
              </div>
              <div className="bg-white rounded-[32px] p-6 custom-shadow border border-stone-100">
                <div className="mb-4 inline-block bg-emerald-50 text-emerald-700 px-3 py-1 rounded-full text-[11px] font-bold border border-emerald-100">
                  ЁЯОп ${meal.nutritionFocus}
                </div>
                <div className="space-y-4">
                  ${meal.items?.map((item, idx) => html`
                    <div key=${idx} className=${`p-4 rounded-2xl border-l-4 ${item.category === 'veggie' ? 'border-emerald-500 bg-emerald-50/50' : item.category === 'protein' ? 'border-orange-500 bg-orange-50/50' : 'border-yellow-500 bg-yellow-50/50'}`}>
                      <h4 className="font-bold text-stone-800 text-lg mb-1">${item.name}</h4>
                      <p className="text-stone-600 text-sm leading-relaxed">${item.description}</p>
                    </div>
                  `)}
                </div>
                <div className="mt-5 p-4 bg-blue-50/80 rounded-2xl text-blue-900 text-sm border border-blue-100">
                  <span className="font-bold">ЁЯТб рдЖрд░реЛрдЧреНрдп рдЯрд┐рдк:</span> ${meal.healthTip}
                </div>
              </div>
            </div>
          `;
        };

        const App = () => {
          const [activeTab, setActiveTab] = useState('plan');
          const [loading, setLoading] = useState(false);
          const [mealPlan, setMealPlan] = useState(null);
          const [error, setError] = useState(null);
          const [selected, setSelected] = useState(new Set());
          const [hasApiKey, setHasApiKey] = useState(false);
          const [manualKey, setManualKey] = useState(process.env.API_KEY || '');

          useEffect(() => {
            const checkKey = async () => {
              if (manualKey) {
                window.process.env.API_KEY = manualKey;
                setHasApiKey(true);
                return;
              }

              if (window.aistudio) {
                const exists = await window.aistudio.hasSelectedApiKey();
                setHasApiKey(exists);
              } else {
                setHasApiKey(!!process.env.API_KEY);
              }
            };
            checkKey();
          }, [manualKey]);

          const handleOpenKey = async () => {
            if (window.aistudio) {
              await window.aistudio.openSelectKey();
              setHasApiKey(true);
            } else {
                setActiveTab('settings');
            }
          };

          const fetchPlan = useCallback(async () => {
            const currentKey = manualKey || process.env.API_KEY;
            if (!currentKey) {
                setError("API рдХреА рдЧрд╣рд╛рд│ рдЖрд╣реЗ. рдХреГрдкрдпрд╛ 'рд╕реЗрдЯрд┐рдВрдЧреНрд╕' рдордзреНрдпреЗ рдЬрд╛рдКрди рдХреА рдПрдВрдЯрд░ рдХрд░рд╛.");
                return;
            }
            
            setLoading(true);
            setError(null);
            try {
              const ai = new GoogleGenAI({ apiKey: currentKey });
              const itemsStr = Array.from(selected).join(", ");
              const prompt = `You are a world-class Maharashtrian clinical dietitian. 
              Create a therapeutic 1-day meal plan for a 50-year-old mother managing both high cholesterol and Type 2 Diabetes.
              Core Rule: The 50-25-25 Thali Rule (50% fiber, 25% protein, 25% complex carbs).
              Ingredients: ${itemsStr || "standard Maharashtrian ingredients"}.
              Constraint: No sugar, Minimal oil. Language: Marathi (рдорд░рд╛рдареА). Traditional Maharashtrian dishes only.`;

              const response = await ai.models.generateContent({
                model: "gemini-3-pro-preview",
                contents: [{ role: 'user', parts: [{ text: prompt }] }],
                config: { 
                    responseMimeType: "application/json", 
                    responseSchema: MEAL_PLAN_SCHEMA,
                    thinkingConfig: { thinkingBudget: 2000 }
                }
              });

              if (response && response.text) {
                setMealPlan(JSON.parse(response.text.trim()));
              }
              window.scrollTo({ top: 0, behavior: 'smooth' });
            } catch (err) {
              console.error(err);
              setError(`рдирд┐рдпреЛрдЬрди рдХрд░рддрд╛рдирд╛ рдЕрдбрдЪрдг рдЖрд▓реА: ${err.message}. рдкреБрдиреНрд╣рд╛ рдкреНрд░рдпрддреНрди рдХрд░рд╛.`);
            } finally {
              setLoading(false);
            }
          }, [selected, manualKey]);

          useEffect(() => {
            if (hasApiKey) fetchPlan();
          }, [hasApiKey]);

          const toggle = (item) => {
            const next = new Set(selected);
            if (next.has(item)) next.delete(item); else next.add(item);
            setSelected(next);
          };

          if (!hasApiKey && activeTab !== 'settings') return html`
            <div className="min-h-screen flex flex-col items-center justify-center p-8 bg-stone-50 text-center animate-in">
              <div className="bg-white p-10 rounded-[40px] shadow-2xl border border-stone-100 max-w-sm">
                <div className="text-6xl mb-6">ЁЯНЫ</div>
                <h2 className="text-2xl font-serif font-bold text-stone-900 mb-4">рд╕реНрд╡рд╛рд╕реНрдереНрдп рдерд╛рд│реА рд╕реБрд░реВ рдХрд░рд╛</h2>
                <p className="text-stone-600 mb-8 text-sm leading-relaxed">
                  рдЖрдИрдЪреНрдпрд╛ рдЙрддреНрддрдо рдЖрд░реЛрдЧреНрдпрд╛рд╕рд╛рдареА рдЖрд╣рд╛рд░ рдирд┐рдпреЛрдЬрди рд╕реБрд░реВ рдХрд░рдгреНрдпрд╛рдкреВрд░реНрд╡реА, рдХреГрдкрдпрд╛ рддреБрдордЪреА Google API рдХреА рдПрдВрдЯрд░ рдХрд░рд╛.
                </p>
                <div className="space-y-4">
                  <button onClick=${handleOpenKey} className="w-full bg-orange-600 text-white py-4 rounded-2xl font-bold shadow-lg shadow-orange-200 active:scale-95 transition-all">
                    ${window.aistudio ? 'API Key рдирд┐рд╡рдбрд╛' : 'API Key рдПрдВрдЯрд░ рдХрд░рд╛'}
                  </button>
                </div>
              </div>
            </div>
          `;

          if (loading) return html`
            <div className="min-h-screen flex flex-col items-center justify-center p-10 bg-stone-50">
              <div className="relative mb-6">
                <div className="w-20 h-20 border-8 border-orange-100 border-t-orange-600 rounded-full animate-spin"></div>
                <div className="absolute inset-0 flex items-center justify-center text-2xl">ЁЯег</div>
              </div>
              <h2 className="text-2xl font-serif font-bold text-stone-800 text-center">рдЖрдИрд╕рд╛рдареА рдкреЛрд╖рдгрддрдЬреНрдЬреНрдЮ <br/>рдЖрд╣рд╛рд░ рдард░рд╡рдд рдЖрд╣реЗрдд...</h2>
            </div>
          `;

          return html`
            <div className="max-w-lg mx-auto px-4 py-8 pb-32">
              <header className="text-center mb-8">
                <h1 className="text-5xl font-serif font-bold text-stone-900 mb-2 tracking-tight">рдЖрдИрдЪреА рдерд╛рд│реА</h1>
                <p className="text-emerald-700 text-[11px] font-black uppercase tracking-[0.2em]">Health & Longevity</p>
              </header>

              <nav className="flex bg-white/80 backdrop-blur-md p-1.5 rounded-2xl shadow-sm border border-stone-200 mb-8 sticky top-4 z-50 overflow-x-auto">
                ${['plan', 'tips', 'stats', 'settings'].map(t => html`
                  <button key=${t} onClick=${() => setActiveTab(t)} className=${`flex-1 min-w-[80px] py-3 rounded-xl font-bold text-[10px] transition-all uppercase ${activeTab === t ? 'bg-orange-600 text-white shadow-md' : 'text-stone-400 hover:text-stone-600'}`}>
                    ${t === 'plan' ? 'рдЖрд╣рд╛рд░' : t === 'tips' ? 'рдордВрддреНрд░' : t === 'stats' ? 'рдирд┐рдпрдо' : 'рд╕реЗрдЯрд┐рдВрдЧреНрд╕'}
                  </button>
                `)}
              </nav>

              ${error && html`
                <div className="bg-red-50 text-red-800 p-6 rounded-[32px] mb-8 text-center text-sm border border-red-100 shadow-sm">
                  <p className="mb-4 font-medium">${error}</p> 
                  <button onClick=${fetchPlan} className="bg-red-600 text-white px-8 py-2 rounded-xl font-bold active:scale-95 transition-all">рдкреБрдиреНрд╣рд╛ рдкреНрд░рдпрддреНрди рдХрд░рд╛</button>
                </div>
              `}

              ${activeTab === 'plan' && html`
                <div className="animate-in">
                  <section className="bg-white rounded-[40px] p-8 custom-shadow border border-stone-100 mb-10">
                    <h3 className="text-xl font-bold mb-6 font-serif flex items-center gap-2">ЁЯз║ рдХрд┐рдЪрдирдордзреНрдпреЗ рдХрд╛рдп рдЖрд╣реЗ?</h3>
                    <div className="space-y-6">
                      ${Object.entries(INVENTORY).map(([key, cat]) => html`
                        <div key=${key}>
                          <p className="text-[9px] font-black text-stone-400 uppercase tracking-widest mb-3">${cat.title}</p>
                          <div className="flex flex-wrap gap-2">
                            ${cat.items.map(item => html`
                              <button key=${item} onClick=${() => toggle(item)} className=${`px-4 py-2 rounded-2xl border text-sm font-bold transition-all ${selected.has(item) ? 'bg-orange-600 text-white border-orange-600 shadow-md' : 'bg-stone-50 text-stone-500 border-stone-200'}`}>
                                ${item}
                              </button>
                            `)}
                          </div>
                        </div>
                      `)}
                      <button onClick=${fetchPlan} className="w-full bg-stone-900 text-white py-5 rounded-[24px] font-bold text-lg shadow-xl active:scale-95 transition-all mt-4">тЬи рдирд┐рдпреЛрдЬрди рдХрд░рд╛</button>
                    </div>
                  </section>
                  ${mealPlan?.meals && html`
                    <div className="space-y-2">
                      <${ThaliCard} meal=${mealPlan.meals.breakfast} type="breakfast" />
                      <${ThaliCard} meal=${mealPlan.meals.lunch} type="lunch" />
                      <${ThaliCard} meal=${mealPlan.meals.eveningSnack} type="eveningSnack" />
                      <${ThaliCard} meal=${mealPlan.meals.dinner} type="dinner" />
                    </div>
                  `}
                </div>
              `}

              ${activeTab === 'tips' && html`
                <div className="space-y-6 animate-in">
                  <div className="bg-white p-8 rounded-[40px] border-l-8 border-emerald-500 custom-shadow">
                    <h4 className="text-2xl font-bold text-emerald-900 mb-6 font-serif">ЁЯлА рдХреЛрд▓реЗрд╕реНрдЯреНрд░реЙрд▓</h4>
                    <ul className="space-y-4 text-stone-700 text-sm leading-relaxed">
                      <li>тЬЕ рд░реЛрдЬ рейреж рдорд┐рдиреАрдЯреЗ рдЪрд╛рд▓рд╛рд╡реЗ.</li>
                      <li>тЬЕ рдлрд╛рдпрдмрд░рдпреБрдХреНрдд рднрд╛рдЬреНрдпрд╛ рдЬрд╛рд╕реНрдд рдЦрд╛.</li>
                      <li>тЬЕ рддреЗрд▓ рдЖрдгрд┐ рддреВрдк рдкреВрд░реНрдгрдкрдгреЗ рдЯрд╛рд│рд╛.</li>
                    </ul>
                  </div>
                </div>
              `}

              ${activeTab === 'stats' && html`
                <div className="bg-white p-10 rounded-[40px] custom-shadow text-center animate-in">
                  <h3 className="text-3xl font-serif font-bold mb-8 text-stone-900">релреж-реирел-реирел рдирд┐рдпрдо</h3>
                  <${ThaliChart} />
                </div>
              `}

              ${activeTab === 'settings' && html`
                <div className="bg-white p-8 rounded-[40px] custom-shadow animate-in">
                  <h3 className="text-2xl font-serif font-bold mb-6">ре▓рдк рд╕реЗрдЯрд┐рдВрдЧреНрд╕</h3>
                  <div className="space-y-6">
                    <div>
                        <label className="block text-[10px] font-black text-stone-400 uppercase tracking-widest mb-2">Gemini API Key</label>
                        <input 
                            type="password" 
                            value=${manualKey} 
                            onChange=${(e) => setManualKey(e.target.value)}
                            placeholder="рддреБрдордЪреА API Key рдпреЗрдереЗ рдкреЗрд╕реНрдЯ рдХрд░рд╛..." 
                            className="w-full p-4 bg-stone-50 border border-stone-200 rounded-2xl text-sm focus:ring-2 focus:ring-orange-500 outline-none transition-all"
                        />
                    </div>
                    <div className="p-4 bg-blue-50 rounded-2xl text-blue-800 text-xs leading-relaxed">
                        <p className="font-bold mb-1">рдЯреАрдк:</p>
                        рд╣реА рдХреА рддреБрдордЪреНрдпрд╛ рдмреНрд░рд╛рдЙрдЭрд░рдордзреНрдпреЗ рд╕реБрд░рдХреНрд╖рд┐рддрдкрдгреЗ рд╡рд╛рдкрд░рд▓реА рдЬрд╛рдИрд▓. рдХреА рдорд┐рд│рд╡рдгреНрдпрд╛рд╕рд╛рдареА <a href="https://aistudio.google.com/app/apikey" target="_blank" className="underline font-bold">Google AI Studio</a> рд▓рд╛ рднреЗрдЯ рджреНрдпрд╛.
                    </div>
                    <button onClick=${() => { setHasApiKey(!!manualKey); setActiveTab('plan'); }} className="w-full bg-stone-900 text-white py-4 rounded-2xl font-bold active:scale-95 transition-all">
                        рд╕реЗрд╡реНрд╣ рдХрд░рд╛ рдЖрдгрд┐ рд╕реБрд░реВ рдХрд░рд╛
                    </button>
                  </div>
                </div>
              `}

              <footer className="mt-20 text-center">
                <p className="text-stone-300 text-[10px] font-black uppercase tracking-[0.3em]">
                    рдЖрдИрдЪреНрдпрд╛ рдЙрддреНрддрдо рдЖрд░реЛрдЧреНрдпрд╛рд╕рд╛рдареА рд╕рдорд░реНрдкрд┐рдд тЭдя╕П
                </p>
              </footer>
            </div>
          `;
        };

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
